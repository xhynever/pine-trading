# 4H Vegas Channel Downtrend Strategy - 版本历史

## v1.0.0 - 2024年初版本
- 基础策略框架实现
- 空头趋势检测 (EMA12 < min(EMA144, EMA156) < min(EMA565, EMA676))
- 多单逻辑 (Duo1)：EMA144斜率 < 15%
- 空单逻辑 (Kong1)：EMA144斜率 > 15%
- 固定止损 5%，分层止盈 (10%, 15%, 25%)
- 基础移动止损逻辑

## v1.1.0 - 核心库函数完成
- vegas_channel_lib.pine：完成EMA计算、趋势检测、斜率计算
- backtest_lib.pine：完成回测统计和性能分析
- 支持自定义参数调整

## v2.0.0 - 功能完善版 (已完成)
### 核心改进
- [x] 完善EMA12上穿EMA144计数逻辑(scema)
- [x] 实现更精准的多单开仓条件（高于/低于EMA12 ±2%）
- [x] 实现更精准的空单开仓条件（多个价位判断：EMA144±2%, EMA150, EMA156, EMA565±2%, EMA600）
- [x] 新增日线EMA参考（EMA12, EMA144, EMA156, EMA565, EMA676 @1d）
- [x] 优化自适应移动止损（基于循环队列，容量48根）
- [x] 新增循环队列库函数（f_create_queue, f_queue_push, f_queue_get等）
- [x] 增强信息面板（显示EMA12上穿次数、日线趋势等）

### 新增功能详解
**多单(Duo1)逻辑：**
- 条件：空头趋势 + EMA144斜率 < 15%
- 标记后等待EMA12上穿EMA144 > 1次
- 价格在EMA12±2%范围内时开仓0.1手
- 自适应移动止损：>8根柱时启动

**空单(Kong1)逻辑：**
- 条件：空头趋势 + EMA144斜率 > 15%
- 满足多个价位条件时(EMA144/150/156/565/600 ±2%)开仓
- 需要价格下穿EMA144触发开仓
- 开仓0.1手，自适应止损

**止盈分层：**
- 第一层：上涨/下跌10% → 平50%
- 第二层：上涨/下跌15% → 平25%
- 第三层：上涨/下跌25% → 平25%

**日线参考：**
- 显示日线空头趋势作为参考指标
- 在信息面板实时显示

### 性能指标目标
- 胜率：> 50%
- 平均利润：> 0
- 最大回撤：< 20%

---

## 版本切换指南

### 使用基础版 (strategy.pine)
```
在TradingView中：
1. 复制strategy.pine代码
2. 选择4H时间框架
3. 选择交易品种
4. 运行回测
```

### 使用增强版 (strategy_enhanced.pine)
```
在TradingView中：
1. 先创建 vegas_channel_lib 库脚本
2. 再创建 strategy_enhanced 策略脚本
3. 参数可在策略设置中调整
```

---

## 修改记录 (Change Log)

### 2024-XX-XX - v2.0.0 更新
**修改者:** [User Name]
**修改内容:**
- 完善EMA144斜率计数逻辑
- 优化开仓价位判断条件

**回测结果:**
- 胜率: XX%
- 总收益: XX
- 最大回撤: XX%
- 夏普比率: XX

---
